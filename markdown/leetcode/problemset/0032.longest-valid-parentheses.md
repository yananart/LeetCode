# 32. æœ€é•¿æœ‰æ•ˆæ‹¬å·

- [ğŸ”—é¢˜ç›®é“¾æ¥](https://leetcode-cn.com/problems/longest-valid-parentheses/)

## åŠ¨æ€è§„åˆ’

æˆ‘ä»¬è®¾`dp[i]`æ˜¯åˆ°ä¸‹æ ‡ä¸ºiçš„ä½ç½®çš„æœ‰çš„è¿ç»­æœ€é•¿æœ‰æ•ˆæ‹¬å·çš„é•¿åº¦ã€‚é‚£ä¹ˆï¼Œå¯¹äºä»¥ä¸‹æƒ…å†µï¼š

- å¦‚æœ`s[i]=')'`ä¸”`s[iâˆ’1]='('`ï¼Œåœ¨ä¸¤ä¸ªå­—ç¬¦å‰çš„åŸºç¡€ä¸Šæœ‰æ•ˆé•¿åº¦å¢åŠ äº†2ï¼Œæ‰€ä»¥`dp[i]=dp[iâˆ’2]+2`ï¼›
- å¦‚æœ`s[i]=')'`ä¸”`s[iâˆ’1]=')'`ï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼ï¼š å¦‚æœ`s[iâˆ’dp[iâˆ’1]âˆ’1]='('`ï¼Œé‚£ä¹ˆ`dp[i]=dp[iâˆ’1]+dp[iâˆ’dp[iâˆ’1]âˆ’2]+2`ï¼Œå…¶ä»£è¡¨ä¸­é—´æ˜¯æœ‰æ•ˆæ‹¬å·ï¼Œè¢«ä¸€å¯¹æ‹¬å·æ‹¬äº†èµ·æ¥

```kotlin
import kotlin.math.max

/**
 * @author Yananart
 */
class Solution {
    fun longestValidParentheses(s: String): Int {
        var ans = 0
        val dp = IntArray(s.length)
        for (i in 1 until s.length) {
            if (s[i] == ')') {
                if (s[i - 1] == '(') {
                    dp[i] = (if (i >= 2) dp[i - 2] else 0) + 2
                } else if (i - dp[i - 1] > 0 && s[i - dp[i - 1] - 1] == '(') {
                    dp[i] = dp[i - 1] + (if ((i - dp[i - 1]) >= 2) dp[i - dp[i - 1] - 2] else 0) + 2
                }
                ans = max(ans, dp[i])
            }
        }
        return ans
    }
}
```

## æ ˆ

æˆ‘ä»¬éå†ä¸€æ¬¡ï¼Œé¦–å…ˆå®šä¹‰æ ˆåº•ä¸ºæœ€æœ‰ä¸€ä¸ªä¸èƒ½åŒ¹é…åº•å³æ‹¬å·ï¼š

- æ¯é‡åˆ°`(`ï¼Œå°†å…¶ä¸‹æ ‡å‹å…¥æ ˆï¼›
- æ¯é‡åˆ°`)`ï¼Œé¦–å…ˆå¼¹å‡ºæ ˆ(å› ä¸ºæˆ‘ä»¬ä¿è¯æ ˆä¸€å®šä¸ä¸ºç©º):
    - å¦‚æœæ ˆä¸ºç©ºï¼Œè¯´æ˜è¿™ä¸ªå³æ‹¬å·ä¸èƒ½åŒ¹é…ï¼ŒæŠŠå®ƒå‹å…¥æ ˆï¼Œå…¶ä½äºæ ˆåº•ï¼›
    - è®¡ç®—ä¸æ ˆé¡¶åæ ‡åº•å·®ï¼Œä¸ºæœ‰æ•ˆé•¿åº¦

```kotlin
import java.util.Stack
import kotlin.math.max

/**
 * @author Yananart
 */
class Solution {
    fun longestValidParentheses(s: String): Int {
        val stack = Stack<Int>()
        var res = 0
        stack.push(-1)
        for (index in s.indices) {
            if (s[index] == '(') {
                stack.push(index)
            } else {
                stack.pop()
                if (stack.isNotEmpty()) {
                    val length = index - stack.peek()
                    res = max(res, length)
                } else {
                    stack.push(index)
                }
            }
        }
        return res
    }
}
```
