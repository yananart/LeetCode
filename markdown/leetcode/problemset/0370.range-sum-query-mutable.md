# 307. åŒºåŸŸå’Œæ£€ç´¢ - æ•°ç»„å¯ä¿®æ”¹

- [ğŸ”—é¢˜ç›®é“¾æ¥](https://leetcode-cn.com/problems/range-sum-query-mutable/)

## æš´åŠ›

```kotlin
/**
 * @author Yananart
 */
class NumArray(val nums: IntArray) {

    fun update(index: Int, `val`: Int) {
        nums[index] = `val`
    }

    fun sumRange(left: Int, right: Int): Int {
        var res = 0
        for (i in left..right) {
            res += nums[i]
        }
        return res
    }
}
```

## æ ‘çŠ¶æ•°ç»„

å‚è€ƒè¯¥[é¢˜è§£](https://leetcode-cn.com/problems/range-sum-query-mutable/solution/-by-hu-ge-8-t4rn/)

é€šè¿‡`lowbit`æ“ä½œå¯ä»¥å°†ä¸€ä¸ªæ•°ç»„åˆ’ä¸ºä¸€ä¸ªä¸ªåŒºé—´ã€‚

`lowbit(int x)=x & -x`

| x         | 1   | 2   | 3   | 4   | 5   | 6   | 7   | 8   | 9   |
|-----------|-----|-----|-----|-----|-----|-----|-----|-----|-----|
| lowbit(x) | 1   | 2   | 1   | 4   | 1   | 2   | 1   | 8   | 1   |

å…¶ä¸»è¦åŠŸèƒ½æ˜¯: æ‰¾åˆ°xçš„äºŒè¿›åˆ¶æ•°çš„æœ€åä¸€ä¸ª1æ‰€è¡¨ç¤ºçš„äºŒè¿›åˆ¶ã€‚

é¢˜ç›®ä¸­çš„æŸ¥åŒºé—´å’Œéœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å‰ç¼€å’Œå¤„ç†ï¼Œè€Œè®¡ç®—å‰ç¼€å’Œå¯ä»¥é€šè¿‡æ ‘çŠ¶æ•°ç»„åˆ’åˆ†çš„ä¸€ä¸ªä¸ªåŒºé—´ç›¸åŠ è·å¾—ã€‚

æˆ‘ä»¬è®¾æ ‘çŠ¶æ•°ç»„`s[i]`ã€‚

![æ ‘çŠ¶æ•°ç»„](0370.range-sum-query-mutable.img/define.png)

æˆ‘ä»¬æ¥ä¸‹æ¥è¦åšçš„å°±æ˜¯ï¼Œåœ¨æ›´æ–°æŸä¸ªæ•°å­—æ—¶å¯ä»¥å°†å…¶å½±å“åˆ°æ ‘çŠ¶æ•°ç»„ä¸­çš„èŠ‚ç‚¹éƒ½æ‰¾å‡ºæ¥è¿›è¡Œæ›´æ–°ã€‚

æ›´æ–°æŸä¸ªèŠ‚ç‚¹xï¼Œåˆ¤æ–­å…¶å½±å“çš„ä¸‹ä¸ªèŠ‚ç‚¹ï¼Œé€šè¿‡`x+lowbit(x)`å¯»æ‰¾ã€‚

![find-high-1](0370.range-sum-query-mutable.img/find-high-1.png)

![find-high-2](0370.range-sum-query-mutable.img/find-high-2.png)

![find-high-3](0370.range-sum-query-mutable.img/find-high-3.png)

å¯»æ‰¾æŸä¸ªåŒºé—´xçš„å‰ä¸€æ®µåŒºé—´ï¼Œé€šè¿‡`x-lowbit(x)`å¯»æ‰¾ã€‚

![find-low-7](0370.range-sum-query-mutable.img/find-low-7.png)

ä»¥ä¸Šå¯ä»¥å®Œæˆè®¾è®¡ã€‚

```kotlin
/**
 * @author Yananart
 */
class NumArray(nums: IntArray) {
    // ç´¯åŠ å’Œ
    var sums: IntArray

    // æ›´æ–°åæ•°ç»„
    var nums: IntArray

    init {
        // åŸæ•°ç»„é•¿åº¦+1, +1çš„åŸå› æ˜¯è®¡ç®—lowbitæ—¶,ä½¿ç”¨ä¸‹æ ‡0ä¼šè¿›å…¥æ­»å¾ªç¯
        sums = IntArray(nums.size + 1)
        this.nums = nums
        for (i in nums.indices) {
            // åˆå§‹åŒ–ç´¯åŠ å’Œæ•°ç»„
            insert(i, nums[i])
        }
    }

    /**
     * æ’å…¥æ•°å­—,åˆå§‹åŒ–
     */
    private fun insert(index: Int, `val`: Int) {
        // ä¸‹æ ‡+1
        var x = index + 1
        while (x < sums.size) {
            sums[x] = sums[x] + `val`
            x += lowBit(x)
        }
    }

    /**
     * è®¡ç®—lowBit
     */
    private fun lowBit(x: Int): Int {
        return x and -x
    }

    /**
     * æŸ¥è¯¢æ ‘çŠ¶æ•°ç»„
     */
    private fun query(x: Int): Int {
        var i = x
        var s = 0
        while (i != 0) {
            s += sums[i]
            i -= lowBit(i)
        }
        return s
    }

    /**
     * æ›´æ–°æ•°ç»„ä»¥åŠç´¯åŠ å’Œ
     */
    fun update(index: Int, `val`: Int) {
        var x = index + 1
        while (x < sums.size) {
            // å‡å»ä¹‹å‰nums[index]çš„å€¼, åŠ ä¸Šæ–°çš„å€¼
            sums[x] = sums[x] - nums[index] + `val`
            x += lowBit(x)
        }
        nums[index] = `val`
    }

    fun sumRange(left: Int, right: Int): Int {
        return query(right + 1) - query(left)
    }
}
```
