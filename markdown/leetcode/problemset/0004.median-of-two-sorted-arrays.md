# 4. å¯»æ‰¾ä¸¤ä¸ªæ­£åºæ•°ç»„çš„ä¸­ä½æ•°

- [ğŸ”—é¢˜ç›®é“¾æ¥](https://leetcode-cn.com/problems/median-of-two-sorted-arrays/)

å¯ä»¥ç”¨å½’å¹¶ï¼Œä½†æ—¶é—´å¤åˆ¶åº¦å°±ä¸Š`O(m+n)`äº†ï¼Œé¢˜ç›®è¦æ±‚`O(log(m+n))`ã€‚

## äºŒåˆ†æ³•

è¦æ‰¾åˆ°ä¸­ä½æ•°ï¼Œæˆ‘ä»¬è½¬åŒ–ä¸ºæ‰¾åˆ°ç¬¬kå¤§çš„æ•°è¿›è¡Œæ“ä½œã€‚

æ¯æ¬¡å–ä¸¤ä¸ªæ•°ç»„å‰é¢`k/2-1`ä½ç½®çš„æ•°è¿›è¡Œåˆ¤æ–­ï¼Œè¾ƒå°çš„é‚£ä¸ªæ•°ï¼Œå…¶è‚¯å®šä¹Ÿå°äºç¬¬kå¤§çš„æ•°ï¼Œæ‰€ä»¥å…¶å‰é¢çš„æ•°ä¹Ÿè¢«æ’é™¤ï¼Œè¿™æ ·æˆ‘ä»¬æº¢å‡ºå°±æ’é™¤æ‰äº†`k/2-1`æ•°ï¼Œä¸‹ä¸€æ¬¡æ“ä½œæ—¶å¾€åå†æ‰¾ç¬¬k/2å¤§çš„æ•°ï¼Œé€’å½’æ“ä½œã€‚

è¯¦è§ä»£ç å’Œå®˜æ–¹é¢˜è§£ã€‚

```kotlin
/**
 * @author Yananart
 */
class Solution {
    fun findMedianSortedArrays(nums1: IntArray, nums2: IntArray): Double {
        // è®¡ç®—æ€»æ•°
        val len = nums1.size + nums2.size
        return if (len % 2 == 1) {
            // å¦‚æœä¸ºå¥‡æ•°ä¸ªï¼Œç›´æ¥å–ä¸­å€¼
            findKth(nums1, 0, nums2, 0, len / 2 + 1).toDouble()
        } else {
            // å¶æ•°ä¸ªï¼Œå–ä¸­é—´ä¸¤ä¸ªæ•°å¹³å‡æ•°
            (findKth(nums1, 0, nums2, 0, len / 2) + findKth(nums1, 0, nums2, 0, len / 2 + 1)) / 2.0
        }
    }

    /**
     * æ‰¾åˆ°ç¬¬kå¤§çš„æ•°
     * @param nums1 æœ‰åºæ•°ç»„
     * @param st1 æŸ¥æ‰¾num1çš„èµ·å§‹ä½ç½®
     * @param nums2 æœ‰åºæ•°ç»„
     * @param st2 æŸ¥æ‰¾num2çš„èµ·å§‹ä½ç½®
     * @param k ç¬¬kå¤§
     * @return ç¬¬kå¤§çš„æ•°
     */
    private fun findKth(nums1: IntArray, st1: Int, nums2: IntArray, st2: Int, k: Int): Int {
        // æ•°ç»„1èµ·å§‹ä¸ºæœ€åï¼Œç›´æ¥ä»æ•°ç»„2å¼€å§‹å–
        if (st1 >= nums1.size) return nums2[st2 + k - 1]
        // æ•°ç»„2èµ·å§‹ä¸ºæœ€åï¼Œç›´æ¥ä»æ•°ç»„1å¼€å§‹å–
        if (st2 >= nums2.size) return nums1[st1 + k - 1]
        // kä¸º1ï¼Œæ¯”è¾ƒä¸¤æ•°ç»„èµ·å§‹ä½ç½®
        if (k == 1) return nums1[st1].coerceAtMost(nums2[st2])

        // å‡è®¾éƒ½å¾€åå–k/2ä¸ªï¼Œå¯ä»¥ä¿è¯å–åˆ°çš„è¾ƒå°çš„å€¼æ˜¯åœ¨ç¬¬kä¸ªæ•°ä¹‹å‰çš„
        val h1 = if (st1 + k / 2 - 1 < nums1.size) nums1[st1 + k / 2 - 1] else Int.MAX_VALUE
        val h2 = if (st2 + k / 2 - 1 < nums2.size) nums2[st2 + k / 2 - 1] else Int.MAX_VALUE

        // å–è¾ƒå°æ•°çš„ä½ç½®ï¼Œå†å¾€åå–k/2ä¸ª
        return if (h1 < h2) {
            findKth(nums1, st1 + k / 2, nums2, st2, k - k / 2)
        } else {
            findKth(nums1, st1, nums2, st2 + k / 2, k - k / 2)
        }
    }
}
```

ç¬¬äºŒç§åŠæ³•ä¹Ÿè¿˜æ˜¯2åˆ†æ³•ï¼Œç”±äºè¿›è¡Œæ•°å­¦æ¨å¯¼ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œæˆ‘ä»¬æœ€åå…¶å®æŠŠåŸä¸¤ä¸ªæ•°ç»„åˆ†å‰²ä¸ºæ–°çš„ä¸¤ä¸ªæ•°ç»„ï¼Œæ»¡è¶³ï¼š

- ä¸€ä¸ªæ•°ç»„é‡Œé¢æ‰€æœ‰å€¼å‡å¤§äºå¦ä¸€ä¸ªæ•°ç»„é‡Œçš„æ‰€æœ‰å€¼ï¼›
- ä¸¤ä¸ªæ•°ç»„é•¿åº¦ç›¸åŒï¼Œæˆ–ä»…ç›¸å·®1ï¼ˆæˆ‘ä»¬ä¸‹é¢è®©å°çš„å¤š1ä¸ªï¼‰

æ‰€ä»¥ï¼Œå¦‚æœæˆ‘ä»¬å•ç‹¬å°†ä¸¤ä¸ªæ•°ç»„åˆ†å‰²æˆä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€ä¸ªæŒ‰å‰iä¸ªåˆ†å‰²ï¼Œç¬¬äºŒä¸ªæŒ‰å‰jä¸ªåˆ†å‰²ï¼Œé‚£ä¹ˆ`i+j==(m+n)/2`(æ€»æ•°å¶æ•°ä¸ªæ—¶)æˆ–`i-1+j==(m+n)/2`(æ€»æ•°å¥‡æ•°ä¸ªæ—¶)ã€‚

æŒ‰ç…§ä¸Šé¢ç»“è®ºï¼Œæˆ‘ä»¬å¯ä»¥æ¨å¯¼å‡ºiå’Œjçš„å…³ç³»ï¼Œå³`j=(m+n+1)/2-i`

é‚£ä¹ˆæˆ‘ä»¬ä»å°çš„æ•°ç»„ç€æ‰‹ï¼Œç”¨äºŒåˆ†çš„ç‰ˆæœ¬å–iå€¼ï¼Œç®—å‡ºjå€¼åï¼Œåˆ¤æ–­ä¸¤ä¸ªæ–°çš„è¾¹ç•Œå·¦è¾¹çš„ä¸¤ä¸ªæ•°æ˜¯å¦éƒ½å°äºå³è¾¹çš„ä¸¤ä¸ªæ•°ï¼Œæ»¡è¶³æ¡ä»¶å³å¯ã€‚

ç„¶åæ€»æ•°å¥‡æ•°æƒ…å†µä¸‹å–å·¦è¾¹æœ€å¤§çš„è¿”å›ï¼Œå¶æ•°æƒ…å†µä¸‹å–å·¦è¾¹æœ€å¤§å’Œå³è¾¹æœ€å°çš„å¹³å‡æ•°è¿”å›ã€‚

```kotlin
/**
 * @author Yananart
 */
class Solution {
    fun findMedianSortedArrays(nums1: IntArray, nums2: IntArray): Double {
        val m = nums1.size
        val n = nums2.size
        if (m > n) {
            return findMedianSortedArrays(nums2, nums1)
        }
        val len = m + n
        var left = 0
        var right = m
        var rightMax = 0
        var leftMin = 0
        while (left <= right) {
            val i = (left + right) / 2
            val j = (m + n + 1) / 2 - i

            val numsAtiAdd1 = if (i == 0) Int.MIN_VALUE else nums1[i - 1]
            val numsAti = if (i == m) Int.MAX_VALUE else nums1[i]
            val numsAtjAdd1 = if (j == 0) Integer.MIN_VALUE else nums2[j - 1]
            val numsAtj = if (j == n) Integer.MAX_VALUE else nums2[j]

            if (numsAtiAdd1 <= numsAtj) {
                rightMax = numsAtiAdd1.coerceAtLeast(numsAtjAdd1)
                leftMin = numsAti.coerceAtMost(numsAtj)
                left = i + 1
            } else {
                right = i - 1
            }
        }

        return if (len % 2 == 0) (rightMax + leftMin) / 2.0 else rightMax.toDouble()
    }
}
```
