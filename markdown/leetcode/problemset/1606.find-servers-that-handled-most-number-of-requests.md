# 1606. æ‰¾åˆ°å¤„ç†æœ€å¤šè¯·æ±‚çš„æœåŠ¡å™¨

- [ğŸ”—é¢˜ç›®é“¾æ¥](https://leetcode-cn.com/problems/find-servers-that-handled-most-number-of-requests/)

æ¨¡æ‹Ÿé¢˜ã€‚

ä½¿ç”¨é›†åˆTreeSetã€ä¼˜å…ˆé˜Ÿåˆ—å¤„ç†ã€‚è¯¦è§ä»£ç ã€‚

```kotlin
import java.util.*
import kotlin.collections.ArrayList
import kotlin.math.max

/**
 * @author Yananart
 */
class Solution {
    fun busiestServers(k: Int, arrival: IntArray, load: IntArray): List<Int> {
        // è®°å½•æ¯ä¸ªæœåŠ¡å™¨çš„è¿è¡Œæ¬¡æ•°
        val count = Array(k) { 0 }
        // è®°å½•æœ€å¤§çš„æ¬¡æ•°
        var max = 0
        // å­˜æ”¾ç¹å¿™çš„æœåŠ¡å™¨
        val busy = PriorityQueue<Message>()
        // å­˜æ”¾ç©ºé—²çš„æœåŠ¡å™¨
        val free = TreeSet<Int>()
        // åˆå§‹çŠ¶æ€æ‰€æœ‰æœåŠ¡å™¨éƒ½æ˜¯ç©ºé—²çš„
        for (i in 0 until k) {
            free.add(i)
        }
        // éå†æ¶ˆæ¯
        for (i in arrival.indices) {
            // å¼€å§‹æ—¶é—´
            val start = arrival[i]
            val end = start + load[i]
            // åˆ¤æ–­åœ¨å½“å‰å¼€å§‹æ—¶é—´ä¸‹ æœ‰æ²¡æœ‰ç©ºé—²çš„æœåŠ¡å™¨
            while (!busy.isEmpty() && busy.peek().end <= start) {
                free.add(busy.poll().server)
            }
            // æ‰¾åˆ°å¤§äºç­‰äºi%kçš„ç©ºé—²æœåŠ¡å™¨
            var server = free.ceiling(i % k)
            if (server == null) {
                // æ²¡æ‰¾åˆ°å°±æ‰¾å¤§äºç­‰äº0çš„
                server = free.ceiling(0)
            }
            if (server == null) {
                // è¿˜æ˜¯æ²¡æ‰¾åˆ°å°±æ”¾å¼ƒ
                continue
            }
            // æŠŠè¯¥æœåŠ¡å™¨ä»ç©ºé—²æ± ä¸­ç§»é™¤
            free.remove(server)
            // åŠ å…¥ç¹å¿™æœåŠ¡å™¨ä¸­
            busy.add(Message(server, end))
            // ä½¿ç”¨æ¬¡æ•°++
            count[server]++
            // æœ€å¤§çš„ä½¿ç”¨æ¬¡æ•°
            max = max(max, count[server])
        }
        val ans = ArrayList<Int>()
        for (i in 0 until k) {
            if (count[i] == max) {
                ans.add(i)
            }
        }
        return ans
    }

    private class Message(val server: Int, val end: Int) : Comparable<Message> {
        override fun compareTo(other: Message): Int {
            return this.end.compareTo(other.end)
        }
    }
}
```
