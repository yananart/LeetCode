# 2049. ç»Ÿè®¡æœ€é«˜åˆ†çš„èŠ‚ç‚¹æ•°ç›®

- [ğŸ”—é¢˜ç›®é“¾æ¥](https://leetcode-cn.com/problems/count-nodes-with-the-highest-score/)

å…¥å‚å·²ç»æä¾›äº†ä¸€ä»½æ¯ä¸ªèŠ‚ç‚¹çˆ¶èŠ‚ç‚¹çš„å…³è”å…³ç³»ï¼Œæˆ‘ä»¬å†æ•´ç†å‡ºæ¯ä¸ªèŠ‚ç‚¹å’Œå­èŠ‚ç‚¹çš„å…³è”å…³ç³»ã€‚

ç„¶åæˆ‘ä»¬ä½¿ç”¨æ·±åº¦æœç´¢ç®—æ³•(`DFS`)ï¼Œå¾—åˆ°æ¯ä¸ªèŠ‚ç‚¹æ€»çš„åä»£èŠ‚ç‚¹æ•°é‡ï¼Œè®¡ä¸º`offspring[]`ã€‚

åœ¨è®¡ç®—æŸä¸ªèŠ‚ç‚¹çš„çš„åˆ†æ•°æ—¶ï¼š

- å¯¹äºçˆ¶èŠ‚ç‚¹å…³è”çš„å­æ ‘ï¼Œå¤§å°ä¸º`offspring[æ ¹]-offspring[å½“å‰]`ï¼›
- å¯¹äºå­èŠ‚ç‚¹å…³è”çš„å­æ ‘ï¼Œå¤§å°ä¸º`offspring[å­]+1`ï¼›

**PS**ï¼šåƒä¸‡æ³¨æ„è®¡ç®—åˆ†æ•°æ—¶Intä¼šæº¢å‡ºï¼Œç”¨Longã€‚

```kotlin
/**
 * @author Yananart
 */
class Solution {
    fun countHighestScoreNodes(parents: IntArray): Int {
        // å­èŠ‚ç‚¹
        val sons = Array(parents.size) { ArrayList<Int>(2) }
        // åä»£æ•°é‡
        val offspring = Array(parents.size) { 0 }

        // å¾—åˆ°æ‰€æœ‰å­èŠ‚ç‚¹
        for (node in 1 until parents.size) {
            sons[parents[node]].add(node)
        }

        // dfsè®¡ç®—æ‰€æœ‰èŠ‚ç‚¹çš„åä»£æ•°é‡
        dfs(0, sons, offspring)

        // éå†æ‰€æœ‰èŠ‚ç‚¹è®¡ç®—åˆ†æ•° ç”¨Longæ³¨æ„æº¢å‡º
        var maxScore = Long.MIN_VALUE
        var res = 0
        for (node in parents.indices) {
            var score = 1L
            if (parents[node] != -1) {
                score *= (offspring[0] - offspring[node])
            }
            for (son in sons[node]) {
                score *= (offspring[son] + 1)
            }
            if (score > maxScore) {
                maxScore = score
                res = 1
            } else if (score == maxScore) {
                res++
            }
        }
        return res
    }

    /**
     * æ·±åº¦ä¼˜å…ˆæœç´¢ï¼Œè®¡ç®—åä»£èŠ‚ç‚¹æ•°é‡
     *
     * @param node å½“å‰è®¡ç®—èŠ‚ç‚¹
     * @param sons å­èŠ‚ç‚¹å…³è”å…³ç³»
     * @param offspring åä»£èŠ‚ç‚¹æ•°é‡
     */
    private fun dfs(node: Int, sons: Array<ArrayList<Int>>, offspring: Array<Int>) {
        var thisOffspring = 0
        for (son in sons[node]) {
            dfs(son, sons, offspring)
            thisOffspring += (offspring[son] + 1)
        }
        offspring[node] = thisOffspring
    }
}
```